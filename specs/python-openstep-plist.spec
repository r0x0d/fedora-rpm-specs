Name:           python-openstep-plist
Version:        0.5.0
Release:        %autorelease
Summary:        ASCII plist parser written in Cython

# The entire source is MIT, except vendor/msinttypes/stdint.h, which is
# BSD-3-Clause, but which is removed in %%prep and does not contribute to the
# licenses of the binary RPMs.
License:        MIT
SourceLicense:  %{license} AND BSD-3-Clause
URL:            https://github.com/fonttools/openstep-plist
Source:         %{pypi_source openstep_plist}

BuildSystem:            pyproject
BuildOption(install):   -l openstep_plist
BuildOption(generate_buildrequires): -t

BuildRequires:  gcc-c++

%global common_description %{expand:
A parser for the "old style" OpenStep property list format (also known as ASCII
plist), written in Cython.}

%description %{common_description}


%package -n python3-openstep-plist
Summary:        %{summary}

%description -n python3-openstep-plist %{common_description}


%prep
%autosetup -n openstep_plist-%{version}

# Remove Cythonized C++ sources:
# https://docs.fedoraproject.org/en-US/packaging-guidelines/Python/#_using_cython
find . -type f -exec grep -FrinIl 'Generated by Cython' '{}' '+' |
  xargs -r -t rm -v

# This is not executable when installed in site-packages, so we remove the
# unnecessary shebang; python3 -m openstep_plist still works.
sed -r -i '1{/^#!/d}' src/openstep_plist/__main__.py

# Vendored header vendor/msinttypes/stdint.h has an allowed license but is only
# needed on Windows: prove that we do not use it by removing it.
rm -rv vendor/


%check -a
%tox -e %{default_toxenv}-nocov -- -- -v


%files -n python3-openstep-plist -f %{pyproject_files}
%doc README.md


%changelog
%autochangelog
