# generated by cabal-rpm-2.2.1 --subpackage
# https://docs.fedoraproject.org/en-US/packaging-guidelines/Haskell/

%{?haskell_setup}

%bcond lua 1

%if %{with lua}
%global hsluacli hslua-cli-1.4.3
%global hslualist hslua-list-1.1.1
%global hsluamoduledoclayout hslua-module-doclayout-1.1.1.2
%global hsluamodulepath hslua-module-path-1.1.1
%global hsluamodulesystem hslua-module-system-1.1.2
%global hsluamoduleversion hslua-module-version-1.1.1
%global hsluamodulezip hslua-module-zip-1.1.3
%global hsluarepl hslua-repl-0.1.2
%global lpeg lpeg-1.0.4
%global pandocluaengine pandoc-lua-engine-0.2.1.2
%global pandocluamarshal pandoc-lua-marshal-0.2.7.1

%global subpkgs %{hslualist} %{hsluamoduledoclayout} %{hsluamodulepath} %{hsluamodulesystem} %{hsluamoduleversion} %{hsluamodulezip} %{hsluarepl} %{hsluacli} %{lpeg} %{pandocluamarshal} %{pandocluaengine}
%endif

Name:           pandoc-cli
Version:        3.1.11.1
# can only be reset when all subpkgs bumped
Release:        32%{?dist}
Summary:        Conversion between documentation formats

License:        GPL-2.0-or-later
Url:            https://hackage.haskell.org/package/%{name}
# Begin cabal-rpm sources:
Source0:        https://hackage.haskell.org/package/%{name}-%{version}/%{name}-%{version}.tar.gz
%if %{with lua}
Source1:        https://hackage.haskell.org/package/%{hsluacli}/%{hsluacli}.tar.gz
Source2:        https://hackage.haskell.org/package/%{hslualist}/%{hslualist}.tar.gz
Source3:        https://hackage.haskell.org/package/%{hsluamoduledoclayout}/%{hsluamoduledoclayout}.tar.gz
Source4:        https://hackage.haskell.org/package/%{hsluamodulepath}/%{hsluamodulepath}.tar.gz
Source5:        https://hackage.haskell.org/package/%{hsluamodulesystem}/%{hsluamodulesystem}.tar.gz
Source6:        https://hackage.haskell.org/package/%{hsluamoduleversion}/%{hsluamoduleversion}.tar.gz
Source7:        https://hackage.haskell.org/package/%{hsluamodulezip}/%{hsluamodulezip}.tar.gz
Source8:        https://hackage.haskell.org/package/%{hsluarepl}/%{hsluarepl}.tar.gz
Source9:        https://hackage.haskell.org/package/%{lpeg}/%{lpeg}.tar.gz
Source10:       https://hackage.haskell.org/package/%{pandocluaengine}/%{pandocluaengine}.tar.gz
Source11:       https://hackage.haskell.org/package/%{pandocluamarshal}/%{pandocluamarshal}.tar.gz
%endif
# End cabal-rpm sources

# Begin cabal-rpm deps:
BuildRequires:  ghc-Cabal-devel
BuildRequires:  ghc-rpm-macros-extra
BuildRequires:  ghc-base-devel
%if %{with lua}
#BuildRequires:  ghc-hslua-cli-devel
%endif
BuildRequires:  ghc-pandoc-devel
%if %{with lua}
#BuildRequires:  ghc-pandoc-lua-engine-devel
%endif
BuildRequires:  ghc-temporary-devel
BuildRequires:  ghc-text-devel
%if %{with ghc_prof}
BuildRequires:  ghc-base-prof
#BuildRequires:  ghc-hslua-cli-prof
BuildRequires:  ghc-pandoc-prof
#BuildRequires:  ghc-pandoc-lua-engine-prof
BuildRequires:  ghc-temporary-prof
BuildRequires:  ghc-text-prof
%endif
# for missing dep 'hslua-cli':
BuildRequires:  ghc-bytestring-devel
BuildRequires:  ghc-hslua-core-devel
BuildRequires:  ghc-hslua-marshalling-devel
BuildRequires:  ghc-lua-devel
BuildRequires:  ghc-unix-devel
%if %{with ghc_prof}
BuildRequires:  ghc-bytestring-prof
BuildRequires:  ghc-hslua-core-prof
BuildRequires:  ghc-hslua-marshalling-prof
BuildRequires:  ghc-lua-prof
BuildRequires:  ghc-unix-prof
%endif
# for missing dep 'hslua-list':
BuildRequires:  ghc-bytestring-devel
BuildRequires:  ghc-hslua-core-devel
%if %{with ghc_prof}
BuildRequires:  ghc-bytestring-prof
BuildRequires:  ghc-hslua-core-prof
%endif
# for missing dep 'hslua-module-doclayout':
BuildRequires:  ghc-doclayout-devel
BuildRequires:  ghc-hslua-devel
%if %{with ghc_prof}
BuildRequires:  ghc-doclayout-prof
BuildRequires:  ghc-hslua-prof
%endif
# for missing dep 'hslua-module-path':
BuildRequires:  ghc-filepath-devel
BuildRequires:  ghc-hslua-core-devel
BuildRequires:  ghc-hslua-marshalling-devel
BuildRequires:  ghc-hslua-packaging-devel
%if %{with ghc_prof}
BuildRequires:  ghc-filepath-prof
BuildRequires:  ghc-hslua-core-prof
BuildRequires:  ghc-hslua-marshalling-prof
BuildRequires:  ghc-hslua-packaging-prof
%endif
# for missing dep 'hslua-module-system':
BuildRequires:  ghc-directory-devel
BuildRequires:  ghc-exceptions-devel
BuildRequires:  ghc-hslua-core-devel
BuildRequires:  ghc-hslua-marshalling-devel
BuildRequires:  ghc-hslua-packaging-devel
%if %{with ghc_prof}
BuildRequires:  ghc-directory-prof
BuildRequires:  ghc-exceptions-prof
BuildRequires:  ghc-hslua-core-prof
BuildRequires:  ghc-hslua-marshalling-prof
BuildRequires:  ghc-hslua-packaging-prof
%endif
# for missing dep 'hslua-module-version':
BuildRequires:  ghc-filepath-devel
BuildRequires:  ghc-hslua-core-devel
BuildRequires:  ghc-hslua-marshalling-devel
BuildRequires:  ghc-hslua-packaging-devel
%if %{with ghc_prof}
BuildRequires:  ghc-filepath-prof
BuildRequires:  ghc-hslua-core-prof
BuildRequires:  ghc-hslua-marshalling-prof
BuildRequires:  ghc-hslua-packaging-prof
%endif
# for missing dep 'hslua-module-zip':
BuildRequires:  ghc-bytestring-devel
BuildRequires:  ghc-filepath-devel
BuildRequires:  ghc-hslua-core-devel
BuildRequires:  ghc-hslua-marshalling-devel
BuildRequires:  ghc-hslua-packaging-devel
BuildRequires:  ghc-hslua-typing-devel
BuildRequires:  ghc-time-devel
BuildRequires:  ghc-zip-archive-devel
%if %{with ghc_prof}
BuildRequires:  ghc-bytestring-prof
BuildRequires:  ghc-filepath-prof
BuildRequires:  ghc-hslua-core-prof
BuildRequires:  ghc-hslua-marshalling-prof
BuildRequires:  ghc-hslua-packaging-prof
BuildRequires:  ghc-hslua-typing-prof
BuildRequires:  ghc-time-prof
BuildRequires:  ghc-zip-archive-prof
%endif
# for missing dep 'hslua-repl':
BuildRequires:  ghc-bytestring-devel
BuildRequires:  ghc-hslua-core-devel
BuildRequires:  ghc-isocline-devel
BuildRequires:  ghc-lua-devel
%if %{with ghc_prof}
BuildRequires:  ghc-bytestring-prof
BuildRequires:  ghc-hslua-core-prof
BuildRequires:  ghc-isocline-prof
BuildRequires:  ghc-lua-prof
%endif
# for missing dep 'lpeg':
BuildRequires:  ghc-lua-devel
%if %{with ghc_prof}
BuildRequires:  ghc-lua-prof
%endif
# for missing dep 'pandoc-lua-engine':
BuildRequires:  ghc-SHA-devel
BuildRequires:  ghc-aeson-devel
BuildRequires:  ghc-bytestring-devel
BuildRequires:  ghc-citeproc-devel
BuildRequires:  ghc-containers-devel
BuildRequires:  ghc-data-default-devel
BuildRequires:  ghc-doclayout-devel
BuildRequires:  ghc-doctemplates-devel
BuildRequires:  ghc-exceptions-devel
BuildRequires:  ghc-hslua-devel
BuildRequires:  ghc-hslua-module-text-devel
BuildRequires:  ghc-mtl-devel
BuildRequires:  ghc-pandoc-types-devel
BuildRequires:  ghc-parsec-devel
%if %{with ghc_prof}
BuildRequires:  ghc-SHA-prof
BuildRequires:  ghc-aeson-prof
BuildRequires:  ghc-bytestring-prof
BuildRequires:  ghc-citeproc-prof
BuildRequires:  ghc-containers-prof
BuildRequires:  ghc-data-default-prof
BuildRequires:  ghc-doclayout-prof
BuildRequires:  ghc-doctemplates-prof
BuildRequires:  ghc-exceptions-prof
BuildRequires:  ghc-hslua-prof
BuildRequires:  ghc-hslua-module-text-prof
BuildRequires:  ghc-mtl-prof
BuildRequires:  ghc-pandoc-types-prof
BuildRequires:  ghc-parsec-prof
%endif
# for missing dep 'pandoc-lua-marshal':
BuildRequires:  ghc-aeson-devel
BuildRequires:  ghc-bytestring-devel
BuildRequires:  ghc-containers-devel
BuildRequires:  ghc-exceptions-devel
BuildRequires:  ghc-hslua-devel
BuildRequires:  ghc-hslua-marshalling-devel
BuildRequires:  ghc-pandoc-types-devel
BuildRequires:  ghc-safe-devel
%if %{with ghc_prof}
BuildRequires:  ghc-aeson-prof
BuildRequires:  ghc-bytestring-prof
BuildRequires:  ghc-containers-prof
BuildRequires:  ghc-exceptions-prof
BuildRequires:  ghc-hslua-prof
BuildRequires:  ghc-hslua-marshalling-prof
BuildRequires:  ghc-pandoc-types-prof
BuildRequires:  ghc-safe-prof
%endif
# End cabal-rpm deps

%description
Pandoc-cli provides a command-line executable that uses the pandoc library to
convert between markup formats.


%package -n pandoc
Summary:        Markup conversion tool
Obsoletes:      pandoc-cli < %{version}-%{release}
Provides:       pandoc-cli = %{version}-%{release}
Requires:       pandoc-common = %{version}


%description -n pandoc
This package provides a command-line executable that uses
the pandoc library to convert between markup formats.

For pdf output please also install pandoc-pdf or weasyprint.


%package -n pandoc-pdf
Summary:        Metapackage for pandoc pdf support
Requires:       pandoc = %{version}-%{release}
Requires:       texlive-collection-latex
Requires:       texlive-ec

%description -n pandoc-pdf
This package pulls in the TeXLive latex package collection needed by
pandoc to generate pdf output using pdflatex.

To use --latex-engine=xelatex or lualatex, install texlive-collection-xetex
or texlive-collection-luatex respectively.


%if %{with lua}
%global main_version %{version}

%if %{defined ghclibdir}
%ghc_lib_subpackage -l MIT %{hsluacli}
%ghc_lib_subpackage -l MIT %{hslualist}
%ghc_lib_subpackage -l MIT %{hsluamoduledoclayout}
%ghc_lib_subpackage -l MIT %{hsluamodulepath}
%ghc_lib_subpackage -l MIT %{hsluamodulesystem}
%ghc_lib_subpackage -l MIT %{hsluamoduleversion}
%ghc_lib_subpackage -l MIT %{hsluamodulezip}
%ghc_lib_subpackage -l MIT %{hsluarepl}
%ghc_lib_subpackage -l MIT %{lpeg}
%ghc_lib_subpackage -l GPL-2.0-or-later %{pandocluaengine}
%ghc_lib_subpackage -l MIT %{pandocluamarshal}
%endif

%global version %{main_version}
%endif


%prep
# Begin cabal-rpm setup:
%setup -q %{?with_lua:-a1 -a2 -a3 -a4 -a5 -a6 -a7 -a8 -a9 -a10 -a11}
# End cabal-rpm setup
%if %{without lua}
cabal-tweak-flag lua False
%endif
cabal-tweak-flag server False


%build
# Begin cabal-rpm build:
%if %{with lua}
%ghc_libs_build %{subpkgs}
%endif
%ghc_bin_build
# End cabal-rpm build


%install
# Begin cabal-rpm install
%if %{with lua}
%ghc_libs_install %{subpkgs}
%endif
%ghc_bin_install
# End cabal-rpm install

%if %{with lua}
ln -s pandoc %{buildroot}%{_bindir}/pandoc-lua
%endif

mkdir -p %{buildroot}%{_datadir}/bash-completion/completions/
%{buildroot}%{_bindir}/pandoc --bash-completion > %{buildroot}%{_datadir}/bash-completion/completions/pandoc

mv %{buildroot}%{_licensedir}/{%{name},pandoc}


%check
%{buildroot}%{_bindir}/pandoc -v
%if %{with lua}
# make sure lua enabled
echo | %{buildroot}%{_bindir}/pandoc --data-dir=%{buildroot}%{_datadir}/%{pandoc}/data --lua-filter /dev/null
%endif


%files -n pandoc
# Begin cabal-rpm files:
%license COPYING.md
%{_bindir}/pandoc
# End cabal-rpm files
%if %{with lua}
%{_bindir}/pandoc-lua
%endif
%{_datadir}/bash-completion/completions/pandoc


%files -n pandoc-pdf


%changelog
* Wed Jul 31 2024 Jens Petersen <petersen@redhat.com> - 3.1.11.1-32
- update to 3.1.11.1
- provide pandoc-pdf meta-package

* Thu Jul 18 2024 Fedora Release Engineering <releng@fedoraproject.org> - 3.1.3-30
- Rebuilt for https://fedoraproject.org/wiki/Fedora_41_Mass_Rebuild

* Wed Feb 28 2024 Jens Petersen <petersen@redhat.com> - 3.1.3-29
- provide a pandoc binary package instead of pandoc-cli

* Wed Feb 28 2024 Jens Petersen <petersen@redhat.com> - 0.1.1.1-28
- hslua subpackages moved here from pandoc

* Thu Feb 22 2024 Jens Petersen <petersen@redhat.com> - 0.1.1.1-1
- spec file generated by cabal-rpm-2.1.5
